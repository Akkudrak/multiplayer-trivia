<!DOCTYPE html>
<html>
<head>
    <title>Trivia Game</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/lib/webserial.min.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="/lib/qrcode.min.js"></script>
    <style media='screen' type='text/css'>
      @font-face {
        font-family: mikado;
        src: url('/lib/fonts/MikadoBold.otf');
        font-weight:400;
        font-weight:normal;
      }
    </style>


    <style type="text/css">
        .hidden{
            display: none;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <script type="text/javascript" src="/scenes/globals.js"></script>
    <script type="text/javascript" src="/scenes/quiz.js"></script>
    <script type="text/javascript" src="/scenes/aux_functions.js"></script>
    <script type="module" src="/scenes/config.js"></script>
    <script type="text/javascript" src="/lib/webrtc.js"></script>


    <!--script type="text/javascript" src="/lib/socket_io.js"></script>
    <script type="text/javascript" src="/lib/webserial.js"></script>
    <script type="text/javascript" src="/lib/start.js"></script>
    <script type="text/javascript" src="/lib/ws_application_ams.js"--></script>
</head>
<body style="margin: 0px;overflow:hidden !important;;padding: 0;">
    <div style="font-family:mikado; position: absolute; left:-1000px; visibility:hidden;">.</div>

    <div  class="" id="trivia_multiplayer" style="padding: 0; margin: 0;overflow:hidden;;"></div>


    <div class="hidden" id="imagenes">
        <img id="team_1_img">
        <img id="team_2_img">
        <img id="team_3_img">
        <img id="team_4_img">
        <img id="team_5_img">
        <img id="team_6_img">
        <img id="team_7_img">
        <img id="team_8_img">
        <img id="team_9_img">
        <img id="team_10_img">
    </div>


    <canvas class="hidden" id="team_canvas" width="390" height="725"></canvas>

<script type="text/javascript">

    generateTeams();
    for (var i = 0; i < 10; i++) {
       generateImages("team_"+(i+1)+"_img","bg_team_"+(i+1)+".png");
    }
    
</script>
</body>
<script>
    
// generateTeams();
        // for (var i = 0; i < 10; i++) {
        //     generateImages("team_"+(i+1)+"_img");
        // }

    var Client = {};
    Client.socket = io.connect();


    Client.sendTest = function(){
        Client.socket.emit('testTeams');
    };

    Client.sendTopic = function(){
        Client.socket.emit('sendTopic');
    };
    Client.sendTopic = function(){
        Client.socket.emit('sendAnswer');
    };
    
    Client.sendReset = function(){
        Client.socket.emit('reset');
    };

    Client.sendResults = function(){
        Client.socket.emit('sendResults');
    };



    Client.sendendGame = function(prizes){
        Client.socket.emit('endGame',prizes);
    };


    Client.socket.on('createTarget',function(data){
        resume()
        console.log("start game",data);
        start=true;
        document.getElementById('phaser-example').classList.remove("hidden");
        document.getElementById('main').classList.add("hidden");
        backgroundMusic.stop();
        ongameMusic.play();

    });


    Client.socket.on('moveTarget_v2',function(data){
        game.scene.scenes[0].moveTarget(data);
    });

    Client.socket.on('reloadGun',function(data){
        cross[data.id].bulletsfired=cross[data.id].bulletsmax;
        cross[data.id].realoads++;
        game.scene.scenes[0].drawBullets(cross[data.id]);
    });

    Client.socket.on('centerCross',function(data){
        cross[data.id].x=mid_h;
        cross[data.id].y=mid_v;
    });

    
    Client.socket.on('userReadyView',function(data){
        console.log('El usuario de equipo esta listo',data)
        usersActive.push(data);
    });

    Client.socket.on('dispense',function(data){
        console.log("endgame");
        endGame();
    });
    var scoreBoardLap = [];
    Client.socket.on('receiveSolution',function(data){
        console.log("recibiendo respuesta");
        data.time = Date.now();
        console.log(data);
        scoreBoardLap.push(data);

    
        if(scoreBoardLap.length == usersActive.length){
            let timing = [];

            scoreBoardLap.forEach((el) => {
                timing.push(el.time);
            })
            
            // timing.forEach((el,idx) => {
            //     // if(scoreBoardLap.idx['valid'] == )
            // })

            

            // Client.socket.emit('sendResults');
        }

        // endGame();
    });

    var characterList = [];
    Client.socket.on('selectedCharacter',function(data){

        receiveMembers.push(data);
        // characterList.push(data);
        console.log(data);
        //ENVIAR PARA PROBAR: Client.socket.emit('testTeams');
        // console.log("testTeams",data);
        // receiveTeam(data)

    });

    Client.sendReset();
</script>
</html>